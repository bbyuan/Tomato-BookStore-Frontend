<script setup lang="ts">
import { ref } from 'vue'
import { useRouter } from 'vue-router'

const router = useRouter()

const categories = ref([
  { id: 1, name: 'ÊñáÂ≠¶' },
  { id: 2, name: 'Á§æÁßë' },
  { id: 3, name: 'Â∞ëÂÑø' },
  { id: 4, name: 'Ëâ∫ÊúØ' },
  { id: 5, name: 'ÁîüÊ¥ª' },
  { id: 6, name: 'ÊñáÊïô' },
  { id: 7, name: 'ÁßëÊäÄ' },
])

// Ê†πÊçÆÂÆûÈôÖÂàÜÁ±ªÊõ¥Êñ∞Â≠êÂàÜÁ±ª
const subcategories = {
  1: [ // ÊñáÂ≠¶
    { id: 101, name: 'Â∞èËØ¥' },
    { id: 102, name: 'Êï£Êñá' },
    { id: 103, name: 'ÊÇ¨ÁñëÊé®ÁêÜ' },
    { id: 104, name: 'ÊñáÂ≠¶ÁêÜËÆ∫' },
    { id: 105, name: 'ÊñáÈõÜ' },
    { id: 106, name: '‰∏ñÁïåÂêçËëó' },
  ],
  2: [ // Á§æÁßë
    { id: 201, name: 'ÂéÜÂè≤' },
    { id: 202, name: 'Âì≤Â≠¶' },
    { id: 203, name: 'ÂÆóÊïô' },
    { id: 204, name: 'Á§æ‰ºöÁßëÂ≠¶' },
    { id: 205, name: 'ÊîøÊ≤ª' },
    { id: 206, name: 'ÂÜõ‰∫ã' },
    { id: 207, name: '‰º†ËÆ∞' },
    { id: 208, name: 'ÊñáÂåñ' },
    { id: 209, name: 'ÁÆ°ÁêÜ' },
    { id: 210, name: 'ÁªèÊµé' },
    { id: 211, name: 'Ê≥ïÂæã' },
  ],
  3: [ // Â∞ëÂÑø
    { id: 301, name: 'ÂÑøÁ´•ÊñáÂ≠¶' },
    { id: 302, name: 'ÁªòÊú¨' },
  ],
  4: [ // Ëâ∫ÊúØ
    { id: 401, name: 'Âä®Êº´' },
    { id: 402, name: 'ÁªòÁîª' },
    { id: 403, name: '‰π¶Ê≥ï' },
    { id: 404, name: 'Èü≥‰πê' },
    { id: 405, name: 'ÊëÑÂΩ±' },
  ],
  5: [ // ÁîüÊ¥ª
    { id: 501, name: 'ÁæéÈ£ü' },
    { id: 502, name: 'ÊóÖÊ∏∏' },
    { id: 503, name: 'ÂÆ∂Â∫≠ÊïôËÇ≤' },
  ],
  6: [ // ÊñáÊïô
    { id: 601, name: 'ÊïôÊùê' },
    { id: 602, name: 'ÂåªÂ≠¶' },
  ],
  7: [ // ÁßëÊäÄ
    { id: 701, name: 'ËÆ°ÁÆóÊú∫' },
    { id: 702, name: 'Ëá™ÁÑ∂ÁßëÂ≠¶' },
  ],
}

// ‰∏≠Ëã±ÊñáÂàÜÁ±ªÊò†Â∞Ñ - Ê†πÊçÆAPIÊé•Âè£Ë¶ÅÊ±Ç
const categoryMapping: { [key: string]: string } = {
  'Â∞èËØ¥': 'Novel',
  'Êï£Êñá': 'Essay',
  'ÊÇ¨ÁñëÊé®ÁêÜ': 'MysteryThriller',
  'ÊñáÂ≠¶ÁêÜËÆ∫': 'LiteraryTheory',
  'ÊñáÈõÜ': 'Anthology',
  '‰∏ñÁïåÂêçËëó': 'WorldClassics',
  'ÂéÜÂè≤': 'History',
  'Âì≤Â≠¶': 'Philosophy',
  'ÂÆóÊïô': 'Religion',
  'Á§æ‰ºöÁßëÂ≠¶': 'SocialScience',
  'ÊîøÊ≤ª': 'Politics',
  'ÂÜõ‰∫ã': 'Military',
  '‰º†ËÆ∞': 'Biography',
  'ÊñáÂåñ': 'Culture',
  'ÁÆ°ÁêÜ': 'Management',
  'ÁªèÊµé': 'Economics',
  'Ê≥ïÂæã': 'Law',
  'ÂÑøÁ´•ÊñáÂ≠¶': 'ChildrenLiterature',
  'ÁªòÊú¨': 'PictureBook',
  'Âä®Êº´': 'Animation',
  'ÁªòÁîª': 'Painting',
  '‰π¶Ê≥ï': 'Calligraphy',
  'Èü≥‰πê': 'Music',
  'ÊëÑÂΩ±': 'Photography',
  'ÁæéÈ£ü': 'Cuisine',
  'ÊóÖÊ∏∏': 'Travel',
  'ÂÆ∂Â∫≠ÊïôËÇ≤': 'FamilyEducation',
  'ÊïôÊùê': 'Textbook',
  'ÂåªÂ≠¶': 'Medicine',
  'ËÆ°ÁÆóÊú∫': 'ComputerScience',
  'Ëá™ÁÑ∂ÁßëÂ≠¶': 'NaturalScience',
  'Êú™ËÆæÁΩÆ': 'NOT_SET'
}

// Ëé∑ÂèñÊåáÂÆöÂàÜÁ±ªÁöÑÂ≠êÂàÜÁ±ª
const getSubcategories = (categoryId: number) => {
  return subcategories[categoryId as keyof typeof subcategories] || []
}

// Ë∑≥ËΩ¨Âà∞ÂàÜÁ±ªÈ°µÈù¢ - Áõ¥Êé•‰ΩøÁî®Ëã±ÊñáÂàÜÁ±ªÂêç‰Ωú‰∏∫URLÂèÇÊï∞
const goToCategory = (categoryName: string) => {
  // ËøôÈáåÊöÇÊó∂Ë∑≥ËΩ¨Âà∞‰∏ªÂàÜÁ±ªÁöÑÁ¨¨‰∏Ä‰∏™Â≠êÂàÜÁ±ª
  const categoryId = categories.value.find(cat => cat.name === categoryName)?.id
  if (categoryId) {
    const subcats = getSubcategories(categoryId)
    if (subcats.length > 0) {
      const englishName = categoryMapping[subcats[0].name] || subcats[0].name
      router.push({
        path: `/category/${englishName}`
      })
    }
  }
}

// Ë∑≥ËΩ¨Âà∞Â≠êÂàÜÁ±ªÈ°µÈù¢ - Áõ¥Êé•‰ΩøÁî®Ëã±ÊñáÂàÜÁ±ªÂêç‰Ωú‰∏∫URLÂèÇÊï∞
const goToSubcategory = (subcategoryName: string) => {
  const englishName = categoryMapping[subcategoryName] || subcategoryName
  router.push({
    path: `/category/${englishName}`
  })
}
</script>

<template>
  <div class="aside-container">
    <div class="category-title">
      <div class="title-icon">üìö</div>
      <span class="title-text">Âõæ‰π¶ÂàÜÁ±ª</span>
    </div>
    
    <div class="category-list">
      <div v-for="category in categories" :key="category.id">
        <div class="category-item" @click="goToCategory(category.name)">
          {{ category.name }}
        </div>
        
        <div class="subcategory-panel">
          <div class="subcategory-grid">
            <div v-for="subcat in getSubcategories(category.id)" 
                 :key="subcat.id" 
                 class="subcategory-item"
                 @click.stop="goToSubcategory(subcat.name)">
              {{ subcat.name }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.aside-container {
  background: #fff;
  border-radius: 12px;
  width: 240px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  border: 1px solid #e8e8e8;
  height: fit-content;
}

.category-title {
  background: #fff;
  color: #333;
  padding: 16px 20px;
  font-weight: 600;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 1px solid #f0f0f0;
}

.title-icon {
  font-size: 18px;
}

.title-text {
  color: #333;
  font-weight: bolder;
}

.category-list {
  overflow-y: auto;
  padding: 8px 0;
}

.category-item {
  padding: 8px 20px 6px 20px;
  font-size: 13px;
  font-weight: 600;
  color: #333;
  margin-bottom: 4px;
  border-left: 3px solid #ff6b6b;
  background: #fafafa;
  cursor: pointer;
  transition: all 0.2s ease;
}

.category-item:hover {
  background: #ff6b6b;
  color: #fff;
}

.subcategory-panel {
  padding: 0 20px 8px 20px;
}

.subcategory-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.subcategory-item {
  padding: 4px 8px;
  font-size: 11px;
  cursor: pointer;
  background: #fff;
  border-radius: 12px;
  border: 1px solid #e8e8e8;
  color: #666;
  transition: all 0.2s ease;
}

.subcategory-item:hover {
  background: #ff6b6b;
  color: #fff;
  border-color: #ff6b6b;
}

/* ÊªöÂä®Êù°Ê†∑Âºè */
.category-list::-webkit-scrollbar {
  width: 4px;
}

.category-list::-webkit-scrollbar-track {
  background: #f5f5f5;
}

.category-list::-webkit-scrollbar-thumb {
  background: #ddd;
  border-radius: 2px;
}

.category-list::-webkit-scrollbar-thumb:hover {
  background: #ccc;
}
</style>
